<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.reminder.geulbeotmall.cart.model.dao.CartMapper">
	<!-- 장바구니 조회용 -->
	<resultMap id="cartResultMap" type="com.reminder.geulbeotmall.cart.model.dto.CartDTO">
		<id property="cartNo" column="CART_NO"/>
		<result property="memberId" column="MEMBER_ID"/>
		<result property="prodNo" column="PROD_NO"/>
		<result property="optionNo" column="OPTION_NO"/>
		<result property="quantity" column="QUANTITY"/>
		<association property="product" resultMap="productResultMap"/> <!-- 1:1 -->
		<association property="option" resultMap="optionResultMap"/> <!-- 1:1 -->
	</resultMap>
	
	<!-- 상품 조회용 -->
	<resultMap id="productResultMap" type="com.reminder.geulbeotmall.product.model.dto.ProductDTO">
		<id property="prodNo" column="PROD_NO"/>
		<result property="categoryNo" column="CATEGORY_NO"/>
		<result property="brandNo" column="BRAND_NO"/>
		<result property="prodName" column="PROD_NAME"/>
		<result property="prodDesc" column="PROD_DESC"/>
		<result property="productTag" column="PRODUCT_TAG"/>
		<result property="discountRate" column="DISCOUNT_RATE"/>
		<result property="prodPrice" column="PROD_PRICE"/>
		<result property="prodOrigin" column="PROD_ORIGIN"/>
		<result property="prodDetailContent" column="PROD_DETAIL_CONTENT"/>
		<result property="prodDetailViewCount" column="PROD_DETAIL_VIEW_COUNT"/>
		<result property="prodEnrollDate" column="PROD_ENROLL_DATE"/>
		<result property="prodChangeDate" column="PROD_CHANGE_DATE"/>
		<result property="prodAvailYn" column="PROD_AVAIL_YN"/>
		<association property="category" resultMap="categoryResultMap"/> <!-- 1:1 -->
		<association property="brand" resultMap="brandResultMap"/> <!-- 1:1 -->
	</resultMap>
	
	<!-- 옵션 조회용 -->
	<resultMap id="optionResultMap" type="com.reminder.geulbeotmall.product.model.dto.OptionDTO">
		<id property="optionNo" column="OPTION_NO"/>
		<result property="refProdNo" column="REF_PROD_NO"/>
		<result property="refStockNo" column="REF_STOCK_NO"/>
		<result property="bodyColor" column="OPT_BODY_COLOR"/>
		<result property="inkColor" column="OPT_INK_COLOR"/>
		<result property="pointSize" column="OPT_POINT_SIZE"/>
		<result property="extraCharge" column="OPT_EXTRA_CHARGE"/>
		<association property="stock" resultMap="stockResultMap"/> <!-- 1:1 -->
	</resultMap>
	
	<!-- 재고 조회용 -->
	<resultMap id="stockResultMap" type="com.reminder.geulbeotmall.product.model.dto.StockDTO">
		<id property="stockNo" column="STOCK_NO"/>
		<result property="stockAmount" column="STOCK_AMOUNT"/>
		<result property="stockDate" column="STOCK_DATE"/>
	</resultMap>
	
	<!-- 카테고리 조회용 -->
	<resultMap id="categoryResultMap" type="com.reminder.geulbeotmall.product.model.dto.CategoryDTO">
		<id property="categoryNo" column="CATEGORY_NO"/>
		<result property="categoryName" column="CATEGORY_NAME"/>
	</resultMap>
	
	<!-- 브랜드 조회용 -->
	<resultMap id="brandResultMap" type="com.reminder.geulbeotmall.product.model.dto.BrandDTO">
		<id property="brandNo" column="BRAND_NO"/>
		<result property="brandName" column="BRAND_NAME"/>
	</resultMap>
	
	<select id="checkCartItem" resultType="_int">
		SELECT
			   NVL(COUNT(OPTION_NO), 0)
		  FROM TBL_CART
		 WHERE OPTION_NO = #{ optionNo }
	</select>
	
	<insert id="addToCart">
		INSERT
		  INTO TBL_CART
		(
		  CART_NO
		, MEMBER_ID
		, PROD_NO
		, OPTION_NO
		, QUANTITY
		)
		VALUES
		(
		  SEQ_CART_NO.NEXTVAL
		, #{ memberId }
		, #{ prodNo }
		, #{ optionNo }
		, #{ quantity }
		)
	</insert>
	
	<select id="getMemberCart" resultMap="cartResultMap">
		SELECT
			   *
		  FROM TBL_CART
		 WHERE MEMBER_ID = #{ id }
	</select>
</mapper>