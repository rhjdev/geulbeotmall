<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 매퍼 네임스페이스 등록 후 사용해야 함 -->
<mapper namespace="com.reminder.geulbeotmall.product.model.dao.ProductMapper">
	<!-- 카테고리 조회용 -->
	<resultMap id="categoryResultMap" type="com.reminder.geulbeotmall.product.model.dto.CategoryDTO">
		<id property="categoryNo" column="CATEGORY_NO"/>
		<result property="categoryName" column="CATEGORY_NAME"/>
	</resultMap>
	
	<!-- 브랜드 조회용 -->
	<resultMap id="brandResultMap" type="com.reminder.geulbeotmall.product.model.dto.BrandDTO">
		<id property="brandNo" column="BRAND_NO"/>
		<result property="brandName" column="BRAND_NAME"/>
	</resultMap>
	
	<!-- 카테고리 목록 조회 -->
	<select id="getCategoryList" resultMap="categoryResultMap">
		SELECT * FROM TBL_CATEGORY
	</select>
	
	<!-- 카테고리 번호 조회 -->
	<select id="checkCategoryNo" parameterType="String" resultType="int">
		SELECT
			   CATEGORY_NO
		  FROM TBL_CATEGORY
		 WHERE CATEGORY_NAME = #{ categoryName }
	</select>
	
	<!-- 카테고리 이름 조회 -->
	<select id="checkCategoryName" parameterType="String" resultType="int">
		SELECT
			   COUNT(*)
		  FROM TBL_CATEGORY
		 WHERE REPLACE(TRIM(CATEGORY_NAME), ' ', '') = #{ categoryName }
	</select>
	
	<!-- 카테고리 추가 -->
	<insert id="addANewCategory">
		INSERT
		  INTO TBL_CATEGORY
		(
		  CATEGORY_NO
		, CATEGORY_NAME
		)
		VALUES
		(
		  SEQ_CATEGORY_NO.NEXTVAL
		, #{ categoryName }
		)
	</insert>
	
	<!-- 브랜드 목록 조회 -->
	<select id="getBrandList" resultMap="brandResultMap">
		SELECT * FROM TBL_BRAND
	</select>
	
	<!-- 브랜드 번호 조회 -->
	<select id="checkBrandNo" parameterType="String" resultType="int">
		SELECT
			   BRAND_NO
		  FROM TBL_BRAND
		 WHERE BRAND_NAME = #{ brandName }
	</select>
	
	<!-- 브랜드 이름 조회 -->
	<select id="checkBrandName" parameterType="String" resultType="int">
		SELECT
			   COUNT(*)
		  FROM TBL_BRAND
		 WHERE REPLACE(TRIM(BRAND_NAME), ' ', '') = #{ brandName }
	</select>
	
	<!-- 브랜드 추가 -->
	<insert id="addNewBrand">
		INSERT
		  INTO TBL_BRAND
		(
		  BRAND_NO
		, BRAND_NAME
		)
		VALUES
		(
		  SEQ_BRAND_NO.NEXTVAL
		, #{ brandName }
		)
	</insert>
	
	<!-- 입고 추가 -->
	<insert id="addProductStock">
		INSERT
		  INTO TBL_STOCK
		(
		  STOCK_NO
		, STOCK_AMOUNT
		, STOCK_DATE
		)
		VALUES
		(
		  SEQ_STOCK_NO.NEXTVAL
		, #{ stockAmount }
		, SYSDATE
		)
	</insert>
	
	<!-- 옵션 추가 -->
	<insert id="addProductOption">
		<selectKey resultType="_int" keyProperty="refStockNo" order="BEFORE">
		SELECT
			   SEQ_STOCK_NO.CURRVAL
		  FROM DUAL
		</selectKey>
		INSERT
		  INTO TBL_OPTION
		(
		  OPTION_NO
		, REF_PROD_NO
		, REF_STOCK_NO
		, OPT_BODY_COLOR
		, OPT_INK_COLOR
		, OPT_POINT_SIZE
		, OPT_EXTRA_CHARGE
		)
		VALUES
		(
		  SEQ_OPT_NO.NEXTVAL
		, SEQ_PROD_NO.CURRVAL
		, #{ refStockNo }
		, #{ bodyColor }
		, #{ inkColor }
		, #{ pointSize }
		, #{ extraCharge }
		)
	</insert>
	
	<!-- 상품 썸네일 등록 -->
	<insert id="attachProdThumbnail">
	<selectKey keyProperty="refProdNo" resultType="Integer" order="BEFORE">
		SELECT
			   SEQ_PROD_NO.CURRVAL
		  FROM DUAL
	</selectKey>
		INSERT
		  INTO TBL_ATTACHMENT
		(
		  ATTACHMENT_NO
		, REF_PROD_NO
		, REF_REVW_NO
		, ORIG_FILE_NAME
		, SAVE_FILE_NAME
		, SAVE_PATH
		, FILE_TYPE
		, ATTACH_STATUS_YN
		)
		VALUES
		(
		  SEQ_ATTACH_NO.NEXTVAL
		, #{ refProdNo }
		, NULL
		, #{ origFileName }
		, #{ saveFileName }
		, #{ savePath }
		, 'THUMB'
		, DEFAULT
		)
	</insert>
	
	<!-- 상품 디테일이미지 등록 -->
	<insert id="attachProdDetailImage">
	<selectKey keyProperty="refProdNo" resultType="Integer" order="BEFORE">
		SELECT
			   SEQ_PROD_NO.CURRVAL
		  FROM DUAL
	</selectKey>
		INSERT
		  INTO TBL_ATTACHMENT
		(
		  ATTACHMENT_NO
		, REF_PROD_NO
		, REF_REVW_NO
		, ORIG_FILE_NAME
		, SAVE_FILE_NAME
		, SAVE_PATH
		, FILE_TYPE
		, ATTACH_STATUS_YN
		)
		VALUES
		(
		  SEQ_ATTACH_NO.NEXTVAL
		, #{ refProdNo }
		, NULL
		, #{ origFileName }
		, #{ saveFileName }
		, #{ savePath }
		, 'CONTENT'
		, DEFAULT
		)
	</insert>
	
	<!-- 상품 등록 -->
	<insert id="addProduct">
		INSERT
		  INTO TBL_PRODUCT
		(
		  PROD_NO
		, CATEGORY_NO
		, BRAND_NO
		, PROD_NAME
		, PROD_DESC
		, PRODUCT_TAG
		, DISCOUNT_RATE
		, PROD_PRICE
		, PROD_ORIGIN
		, PROD_DETAIL_CONTENT
		, PROD_ENROLL_DATE
		, PROD_CHANGE_DATE
		, PROD_AVAIL_YN
		)
		VALUES
		(
		  SEQ_PROD_NO.NEXTVAL
		, #{ categoryNo }
		, #{ brandNo }
		, #{ prodName }
		, #{ prodDesc }
		, #{ productTag }
		, #{ discountRate }
		, #{ prodPrice }
		, #{ prodOrigin }
		, #{ prodDetailContent }
		, SYSDATE
		, NULL
		, DEFAULT
		)
	</insert>
</mapper>